{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>{{ produto.nome }} | Sayuri's Brigadeiros</title>
  <link rel="stylesheet" href="{% static 'CSS/base.css' %}">
  <link rel="stylesheet" href="{% static 'CSS/produto_detalhe.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Voces&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Cabeçalho -->
  <header class="produto-header">
    <a href="{% url 'cardapio' %}" class="voltar">← Voltar ao cardápio</a>
    <img src="{% static 'src/TCC.png' %}" alt="Logo Sayuri's Brigadeiros" class="logo-header">
  </header>

  <!-- Conteúdo principal -->
  <main class="produto-container">
    <div class="produto-card">
      {% if produto.imagem %}
        <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}" class="produto-imagem">
      {% endif %}

      <div class="produto-info">
        <h1 class="produto-nome">{{ produto.nome }}</h1>
        <p class="produto-descricao">{{ produto.descricao }}</p>

        <!-- Bloco de informações -->
        <div id="info-categoria" style="margin:1rem 0 1.25rem 0;"></div>

        <div class="quantidade-wrapper">
          <button class="btn-quantidade menos">−</button>
          <span class="quantidade" id="quantidade">25</span>
          <button class="btn-quantidade mais">+</button>
        </div>

        <div class="add-wrapper">
          <button class="btn-add" id="btnAdicionar">Adicionar</button>
          <span class="total" id="total">R$ 0,00</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Script -->
  <script>
document.addEventListener("DOMContentLoaded", function() {
  const nomeProduto = "{{ produto.nome }}".toLowerCase();

  // preços por tipo
  const CATEGORIAS = {
    gourmet: 1.50,
    premium: 1.80,     // "gourmet premium"
    especial: 2.00
  };

  // detecta tipo pelo nome do produto
  let unit = CATEGORIAS.gourmet; // padrão
  if (nomeProduto.includes("premium")) unit = CATEGORIAS.premium;
  else if (nomeProduto.includes("especial")) unit = CATEGORIAS.especial;
  else if (nomeProduto.includes("gourmet")) unit = CATEGORIAS.gourmet;

  // contador: mínimo 25, passo 1
  const minimo = 25;
  const passo = 1;
  let quantidade = minimo;

  // refs DOM (mantém seus ids/classes originais)
  const spanQtd  = document.getElementById("quantidade");
  const spanTot  = document.getElementById("total");
  const btnMais  = document.querySelector(".mais");
  const btnMenos = document.querySelector(".menos");
  const btnAdd   = document.getElementById("btnAdicionar");

  function atualizarTotal() {
    const total = quantidade * unit; // sem mostrar preço/unidade
    spanQtd.textContent = quantidade;
    spanTot.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
  }

  btnMais.addEventListener("click", () => {
    quantidade += passo;     // agora 1 em 1
    atualizarTotal();
  });

  btnMenos.addEventListener("click", () => {
    if (quantidade > minimo) {
      quantidade -= passo;   // agora 1 em 1
      atualizarTotal();
    }
  });

  btnAdd.addEventListener("click", () => {
    const produto = {
      name: "{{ produto.nome }}",
      price: unit,                     // guardo unit p/ carrinho
      quantidade: quantidade,
      subtotal: quantidade * unit
    };
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.push(produto);
    localStorage.setItem("cart", JSON.stringify(cart));
    alert(`${quantidade} unidades de "${produto.name}" foram adicionadas ao carrinho!`);
  });

  atualizarTotal();
});
</script>

</body>
</html>